<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stream Configuration - Live Test</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Toast动画 */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      transform: translateX(400px);
      transition: all 0.3s;
    }

    .toast.show {
      transform: translateX(0);
    }

    /* 高级选项内容显示 */
    .advanced-content {
      display: none;
    }

    .advanced-content.show {
      display: block;
    }

    /* 侧边导航栏过渡动画 */
    .sidebar {
      transition: width 0.3s ease;
    }

    /* 导航项激活状态 */
    .nav-item.active {
      background-color: #e5e7eb;
      border-left: 4px solid #3b82f6;
    }

    .nav-item:hover {
      background-color: #f3f4f6;
    }

    /* 折叠时的提示 */
    .sidebar.collapsed .nav-text {
      display: none;
    }

    .sidebar.collapsed .nav-item {
      justify-content: center;
    }

    button {
      cursor: pointer;
    }
  </style>
  <script src="./lib/tailwind.min.js"></script>
</head>

<body class="font-sans bg-gray-100 h-screen text-gray-800 flex">
  <!-- 左侧导航栏 -->
  <aside id="sidebar" class="sidebar bg-white border-r border-gray-200 flex flex-col" style="width: 240px;">
    <!-- Logo区域 -->
    <div class="p-4 border-b border-gray-200 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <i class="fas fa-video text-blue-600 text-xl"></i>
        <span class="nav-text font-bold text-gray-800 text-lg">流媒体中心</span>
      </div>
      <button id="sidebarToggle" class="text-gray-500 hover:text-gray-700 p-1">
        <i class="fas fa-bars"></i>
      </button>
    </div>

    <!-- 导航菜单 -->
    <nav class="flex-1 p-3">
      <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer mb-1" data-page="index.html">
        <i class="fas fa-play-circle text-lg text-gray-600"></i>
        <span class="nav-text text-gray-700 font-medium">播放器</span>
      </div>
      <div class="nav-item active flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer mb-1" data-page="config.html">
        <i class="fas fa-cog text-lg text-gray-600"></i>
        <span class="nav-text text-gray-700 font-medium">配置管理</span>
      </div>
      <div class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer mb-1" data-page="monitor.html">
        <i class="fas fa-chart-line text-lg text-gray-600"></i>
        <span class="nav-text text-gray-700 font-medium">性能监控</span>
      </div>
      
      <!-- 分隔线 -->
      <div class="my-3 border-t border-gray-200"></div>
      
      <!-- 快捷操作 -->
      <div class="px-2 mb-2">
        <div class="nav-text text-xs text-gray-500 font-semibold uppercase tracking-wider px-2">快捷操作</div>
      </div>
      <div id="quickExportBtn" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer mb-1">
        <i class="fas fa-download text-lg text-blue-600"></i>
        <span class="nav-text text-gray-700 font-medium">导出配置</span>
      </div>
      <div id="quickImportBtn" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer mb-1">
        <i class="fas fa-upload text-lg text-green-600"></i>
        <span class="nav-text text-gray-700 font-medium">导入配置</span>
      </div>
    </nav>

    <!-- 底部状态 -->
    <div class="p-4 border-t border-gray-200">
      <div class="flex items-center gap-3">
        <div class="w-2 h-2 rounded-full bg-green-500"></div>
        <span class="nav-text text-sm text-gray-600" id="configCountStatus">0 个配置</span>
      </div>
    </div>
  </aside>

  <!-- 主内容区域 -->
  <main class="flex-1 overflow-auto">
    <!-- 顶部面包屑导航 -->
    <div class="bg-white border-b border-gray-200 px-6 py-4">
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <i class="fas fa-home"></i>
        <span class="text-gray-400">/</span>
        <span class="font-medium text-gray-800">配置管理</span>
      </div>
    </div>

    <!-- 内容区域 -->
    <div class="p-6">
      <!-- 操作按钮栏 -->
      <div class="flex gap-2.5 mb-6 flex-wrap">
        <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 flex items-center gap-2 text-white bg-blue-600 hover:bg-blue-700" id="importBtn">
          <i class="fas fa-upload"></i>
          导入配置
        </button>
        <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 flex items-center gap-2 text-white bg-green-600 hover:bg-green-700" id="exportBtn">
          <i class="fas fa-download"></i>
          导出配置
        </button>
      </div>

      <!-- Config Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-5">
        <!-- Add New Configuration Panel -->
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
          <h2 class="text-lg mb-5 text-gray-800 flex items-center gap-2.5 font-semibold">
            <i class="fas fa-plus text-blue-600"></i>
            添加新配置
          </h2>

          <form id="configForm">
            <div class="mb-4">
              <label for="configName" class="block mb-1.5 font-medium text-gray-600 text-sm">配置名称:</label>
              <input type="text" id="configName" placeholder="例如: 本地测试" required class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
            </div>

            <div class="mb-4">
              <label for="streamName" class="block mb-1.5 font-medium text-gray-600 text-sm">流名称:</label>
              <input type="text" id="streamName" placeholder="demo" required class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
            </div>

            <div class="mb-4">
              <label for="protocol" class="block mb-1.5 font-medium text-gray-600 text-sm">协议:</label>
              <select id="protocol" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                <option value="flv">FLV</option>
                <option value="hls">HLS</option>
                <option value="rtmp">RTMP</option>
                <option value="webrtc">WebRTC</option>
              </select>
            </div>

            <div class="mb-4">
              <label for="serverUrl" class="block mb-1.5 font-medium text-gray-600 text-sm">服务器地址:</label>
              <input type="text" id="serverUrl" placeholder="localhost:8000" value="localhost:8000" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
            </div>

            <div class="flex items-center gap-2.5 mb-3">
              <input type="checkbox" id="autoReconnect" checked class="w-auto">
              <label for="autoReconnect" class="font-medium text-gray-600 cursor-pointer text-sm">自动重连</label>
            </div>

            <div class="flex items-center gap-2.5 mb-4">
              <input type="checkbox" id="lowLatency" checked class="w-auto">
              <label for="lowLatency" class="font-medium text-gray-600 cursor-pointer text-sm">低延迟模式</label>
            </div>

            <button type="button" class="bg-transparent border-0 text-blue-600 cursor-pointer font-medium mb-4 hover:underline text-sm" id="advancedToggle">
              <i class="fas fa-chevron-down"></i> 高级选项
            </button>

            <div class="advanced-content bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200" id="advancedContent">
              <div class="mb-4">
                <label for="bufferSize" class="block mb-1.5 font-medium text-gray-600 text-sm">缓冲区大小 (KB):</label>
                <input type="number" id="bufferSize" value="128" min="64" max="1024" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500">
              </div>

              <div class="mb-4">
                <label for="maxRetries" class="block mb-1.5 font-medium text-gray-600 text-sm">最大重试次数:</label>
                <input type="number" id="maxRetries" value="5" min="1" max="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500">
              </div>

              <div class="mb-4">
                <label for="customHeaders" class="block mb-1.5 font-medium text-gray-600 text-sm">自定义头部 (JSON):</label>
                <textarea id="customHeaders" rows="3" placeholder='{"Authorization": "Bearer token"}' class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500"></textarea>
              </div>

              <div class="mb-0">
                <label for="description" class="block mb-1.5 font-medium text-gray-600 text-sm">描述:</label>
                <textarea id="description" rows="2" placeholder="配置的详细描述..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:border-blue-500"></textarea>
              </div>
            </div>

            <div class="mt-4 flex gap-2">
              <button type="submit" class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-blue-600 hover:bg-blue-700">
                <i class="fas fa-save"></i>
                保存配置
              </button>
              <button type="button" class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-gray-600 hover:bg-gray-700" id="resetForm">
                <i class="fas fa-undo"></i>
                重置
              </button>
            </div>
          </form>
        </div>

        <!-- Quick Test Panel -->
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
          <h2 class="text-lg mb-5 text-gray-800 flex items-center gap-2.5 font-semibold">
            <i class="fas fa-rocket text-blue-600"></i>
            快速测试
          </h2>

          <div class="mb-4">
            <label class="block mb-1.5 font-medium text-gray-600 text-sm">快速启动测试:</label>
            <div class="flex gap-2 items-center flex-wrap">
              <input type="text" id="quickStream" placeholder="输入流名称" class="flex-1 min-w-[200px] px-3 py-2 border border-gray-300 rounded-lg text-sm">
              <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-green-600 hover:bg-green-700" id="quickTestBtn">
                <i class="fas fa-play"></i>
                测试
              </button>
            </div>
          </div>

          <div class="mb-4">
            <label class="block mb-1.5 font-medium text-gray-600 text-sm">预设流:</label>
            <div class="flex gap-2 flex-wrap">
              <button class="px-4 py-2 border border-gray-300 bg-white rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 hover:bg-gray-50" data-stream="demo">Demo</button>
              <button class="px-4 py-2 border border-gray-300 bg-white rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 hover:bg-gray-50" data-stream="test">Test</button>
              <button class="px-4 py-2 border border-gray-300 bg-white rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 hover:bg-gray-50" data-stream="live">Live</button>
            </div>
          </div>

          <div class="mb-4">
            <div>
              <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-orange-600 hover:bg-orange-700" id="checkServerBtn">
                <i class="fas fa-heartbeat"></i>
                检查服务状态
              </button>
              <div id="serverStatus" class="mt-2"></div>
            </div>
          </div>

          <div class="mb-0">
            <div class="flex gap-2">
              <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-gray-600 hover:bg-gray-700" id="generateCmdBtn">
                <i class="fas fa-terminal"></i>
                生成推流命令
              </button>
              <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-gray-600 hover:bg-gray-700" id="copyCmdBtn">
                <i class="fas fa-copy"></i>
                复制
              </button>
            </div>
            <div id="generatedCmd" class="mt-2 hidden">
              <textarea id="cmdOutput" rows="4" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-xs mt-2 bg-gray-50 min-h-48"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Config List -->
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <h2 class="text-lg mb-5 text-gray-800 flex items-center gap-2.5 justify-between font-semibold">
          <span class="flex items-center gap-2.5">
            <i class="fas fa-list text-blue-600"></i>
            配置列表
          </span>
          <span class="text-base font-normal text-gray-600">
            <span id="configCount">0</span> 个配置
          </span>
        </h2>

        <div id="configItems">
          <!-- 配置项将在这里动态生成 -->
        </div>

        <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-5 text-center mt-5">
          <i class="fas fa-file-export text-3xl text-gray-400 mb-2.5"></i>
          <p class="text-gray-600 mb-4 text-sm">
            导出所有配置为 JSON 文件，或从文件导入配置
          </p>
          <input type="file" id="importFile" accept=".json" class="hidden">
          <button class="px-4 py-2.5 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 inline-flex items-center gap-2 text-white bg-gray-600 hover:bg-gray-700" id="selectFileBtn">
            <i class="fas fa-file-upload"></i>
            选择导入文件
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // 侧边栏折叠功能
    document.getElementById('sidebarToggle').addEventListener('click', function() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.style.width === '240px') {
        sidebar.style.width = '80px';
        sidebar.classList.add('collapsed');
      } else {
        sidebar.style.width = '240px';
        sidebar.classList.remove('collapsed');
      }
    });

    // 导航项点击事件
    document.querySelectorAll('.nav-item[data-page]').forEach(item => {
      item.addEventListener('click', function() {
        const page = this.dataset.page;
        window.location.href = page;
      });
    });

    class StreamConfigManager {
      constructor() {
        this.configs = this.loadConfigs();
        this.initializeElements();
        this.bindEvents();
        this.renderConfigs();
        this.loadDefaultConfigs();
        this.updateConfigCountStatus();
      }

      initializeElements() {
        this.elements = {
          configForm: document.getElementById('configForm'),
          configName: document.getElementById('configName'),
          streamName: document.getElementById('streamName'),
          protocol: document.getElementById('protocol'),
          serverUrl: document.getElementById('serverUrl'),
          autoReconnect: document.getElementById('autoReconnect'),
          lowLatency: document.getElementById('lowLatency'),
          bufferSize: document.getElementById('bufferSize'),
          maxRetries: document.getElementById('maxRetries'),
          customHeaders: document.getElementById('customHeaders'),
          description: document.getElementById('description'),
          resetForm: document.getElementById('resetForm'),
          quickStream: document.getElementById('quickStream'),
          quickTestBtn: document.getElementById('quickTestBtn'),
          checkServerBtn: document.getElementById('checkServerBtn'),
          generateCmdBtn: document.getElementById('generateCmdBtn'),
          configItems: document.getElementById('configItems'),
          configCount: document.getElementById('configCount'),
          exportBtn: document.getElementById('exportBtn'),
          importBtn: document.getElementById('importBtn'),
          importFile: document.getElementById('importFile'),
          selectFileBtn: document.getElementById('selectFileBtn'),
          advancedToggle: document.getElementById('advancedToggle'),
          advancedContent: document.getElementById('advancedContent'),
          serverStatus: document.getElementById('serverStatus'),
          generatedCmd: document.getElementById('generatedCmd'),
          cmdOutput: document.getElementById('cmdOutput'),
          copyCmdBtn: document.getElementById('copyCmdBtn'),
          quickExportBtn: document.getElementById('quickExportBtn'),
          quickImportBtn: document.getElementById('quickImportBtn'),
          configCountStatus: document.getElementById('configCountStatus')
        };
      }

      bindEvents() {
        this.elements.configForm.addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveConfig();
        });

        this.elements.resetForm.addEventListener('click', () => this.resetForm());
        this.elements.quickTestBtn.addEventListener('click', () => this.quickTest());
        this.elements.checkServerBtn.addEventListener('click', () => this.checkServer());
        this.elements.generateCmdBtn.addEventListener('click', () => this.generatePushCommand());
        this.elements.exportBtn.addEventListener('click', () => this.exportConfigs());
        this.elements.importBtn.addEventListener('click', () => this.elements.importFile.click());
        this.elements.selectFileBtn.addEventListener('click', () => this.elements.importFile.click());
        this.elements.importFile.addEventListener('change', (e) => this.importConfigs(e));
        this.elements.copyCmdBtn.addEventListener('click', () => this.copyCommand());
        this.elements.quickExportBtn.addEventListener('click', () => this.exportConfigs());
        this.elements.quickImportBtn.addEventListener('click', () => this.elements.importFile.click());

        this.elements.advancedToggle.addEventListener('click', () => {
          const content = this.elements.advancedContent;
          const icon = this.elements.advancedToggle.querySelector('i');

          content.classList.toggle('show');
          icon.className = content.classList.contains('show') ?
            'fas fa-chevron-up' : 'fas fa-chevron-down';
        });

        // 预设流按钮
        document.querySelectorAll('[data-stream]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const streamName = e.target.dataset.stream;
            this.testStream(streamName);
          });
        });
      }

      loadConfigs() {
        const saved = localStorage.getItem('streamConfigs');
        return saved ? JSON.parse(saved) : [];
      }

      saveConfigs() {
        localStorage.setItem('streamConfigs', JSON.stringify(this.configs));
        this.updateConfigCountStatus();
      }

      updateConfigCountStatus() {
        this.elements.configCountStatus.textContent = `${this.configs.length} 个配置`;
      }

      saveConfig() {
        const config = {
          id: Date.now(),
          name: this.elements.configName.value,
          streamName: this.elements.streamName.value,
          protocol: this.elements.protocol.value,
          serverUrl: this.elements.serverUrl.value,
          autoReconnect: this.elements.autoReconnect.checked,
          lowLatency: this.elements.lowLatency.checked,
          bufferSize: parseInt(this.elements.bufferSize.value),
          maxRetries: parseInt(this.elements.maxRetries.value),
          customHeaders: this.elements.customHeaders.value,
          description: this.elements.description.value,
          createdAt: new Date().toISOString(),
          lastUsed: null
        };

        this.configs.push(config);
        this.saveConfigs();
        this.renderConfigs();
        this.resetForm();
        this.showToast('配置已保存', 'success');
      }

      deleteConfig(id) {
        if (confirm('确定要删除这个配置吗？')) {
          this.configs = this.configs.filter(config => config.id !== id);
          this.saveConfigs();
          this.renderConfigs();
          this.showToast('配置已删除', 'success');
        }
      }

      editConfig(id) {
        const config = this.configs.find(c => c.id === id);
        if (config) {
          this.elements.configName.value = config.name;
          this.elements.streamName.value = config.streamName;
          this.elements.protocol.value = config.protocol;
          this.elements.serverUrl.value = config.serverUrl;
          this.elements.autoReconnect.checked = config.autoReconnect;
          this.elements.lowLatency.checked = config.lowLatency;
          this.elements.bufferSize.value = config.bufferSize;
          this.elements.maxRetries.value = config.maxRetries;
          this.elements.customHeaders.value = config.customHeaders;
          this.elements.description.value = config.description;

          // 删除原配置，下次保存会创建新的
          this.deleteConfig(id);

          // 滚动到表单
          this.elements.configForm.scrollIntoView({ behavior: 'smooth' });
        }
      }

      testConfig(id) {
        const config = this.configs.find(c => c.id === id);
        if (config) {
          // 更新最后使用时间
          config.lastUsed = new Date().toISOString();
          this.saveConfigs();
          this.renderConfigs();

          this.testStream(config.streamName, config);
        }
      }

      testStream(streamName, config = null) {
        const url = `index.html?stream=${encodeURIComponent(streamName)}`;

        if (config) {
          // 将配置保存到sessionStorage供播放器使用
          sessionStorage.setItem('currentStreamConfig', JSON.stringify(config));
        }

        window.open(url, '_blank');
        this.showToast(`正在测试流: ${streamName}`, 'info');
      }

      quickTest() {
        const streamName = this.elements.quickStream.value.trim();
        if (streamName) {
          this.testStream(streamName);
          this.elements.quickStream.value = '';
        } else {
          this.showToast('请输入流名称', 'error');
        }
      }

      async checkServer() {
        const serverUrl = this.elements.serverUrl.value;
        const statusDiv = this.elements.serverStatus;

        statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 检查中...';

        try {
          const response = await fetch(`http://${serverUrl}/api/streams`, {
            method: 'GET',
            timeout: 5000
          });

          if (response.ok) {
            const data = await response.json();
            statusDiv.innerHTML = `
                <div class="text-green-600 mt-2 text-sm">
                    <i class="fas fa-check-circle"></i> 
                    服务正常 (${Object.keys(data).length} 个活跃流)
                </div>
            `;
          } else {
            throw new Error('服务响应异常');
          }
        } catch (error) {
          statusDiv.innerHTML = `
              <div class="text-red-600 mt-2 text-sm">
                  <i class="fas fa-times-circle"></i> 
                  连接失败: ${error.message}
              </div>
          `;
        }
      }

      generatePushCommand() {
        const streamName = this.elements.streamName.value || 'demo';
        const serverUrl = this.elements.serverUrl.value;

        const commands = [
          '# FFmpeg 推流命令:',
          `ffmpeg -re -i input.mp4 -c copy -f flv rtmp://${serverUrl}/live/${streamName}`,
          '',
          '# OBS 推流地址:',
          `服务器: rtmp://${serverUrl}/live`,
          `推流码: ${streamName}`,
          '',
          '# 播放地址:',
          `FLV: http://${serverUrl}/live/${streamName}.flv`,
          `HLS: http://${serverUrl}/live/${streamName}/index.m3u8`
        ].join('\n');

        this.elements.cmdOutput.value = commands;
        this.elements.generatedCmd.classList.remove('hidden');
      }

      copyCommand() {
        this.elements.cmdOutput.select();
        document.execCommand('copy');
        this.showToast('命令已复制到剪贴板', 'success');
      }

      resetForm() {
        this.elements.configForm.reset();
        this.elements.serverUrl.value = 'localhost:8000';
        this.elements.bufferSize.value = '128';
        this.elements.maxRetries.value = '5';
      }

      renderConfigs() {
        const container = this.elements.configItems;
        container.innerHTML = '';

        if (this.configs.length === 0) {
          container.innerHTML = `
              <div class="text-center py-10 text-gray-600">
                  <i class="fas fa-inbox text-5xl mb-4 text-gray-400"></i>
                  <p>还没有配置，<a href="#" onclick="document.getElementById('configName').focus()" class="text-blue-600 hover:underline">添加第一个配置</a></p>
              </div>
          `;
          this.elements.configCount.textContent = '0';
          return;
        }

        this.configs.forEach(config => {
          const configItem = document.createElement('div');
          configItem.className = 'border border-gray-200 rounded-lg p-4 mb-4 transition-all duration-200 hover:border-blue-500 hover:shadow-md';

          const lastUsed = config.lastUsed ?
            new Date(config.lastUsed).toLocaleString() : '从未使用';

          configItem.innerHTML = `
              <div class="flex justify-between items-center mb-2.5">
                  <div class="font-semibold text-gray-800 text-base">${config.name}</div>
                  <div class="flex gap-1.5">
                      <button class="px-3 py-2 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 text-white bg-green-600 hover:bg-green-700" onclick="configManager.testConfig(${config.id})" title="测试配置">
                          <i class="fas fa-play"></i>
                      </button>
                      <button class="px-3 py-2 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 text-white bg-gray-600 hover:bg-gray-700" onclick="configManager.editConfig(${config.id})" title="编辑配置">
                          <i class="fas fa-edit"></i>
                      </button>
                      <button class="px-3 py-2 border-0 rounded-lg cursor-pointer text-sm font-medium transition-all duration-200 text-white bg-red-600 hover:bg-red-700" onclick="configManager.deleteConfig(${config.id})" title="删除配置">
                          <i class="fas fa-trash"></i>
                      </button>
                  </div>
              </div>
              <div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-2.5 text-gray-600 text-sm">
                  <div class="flex gap-1.5">
                      <span class="font-medium">流名称:</span>
                      <span>${config.streamName}</span>
                  </div>
                  <div class="flex gap-1.5">
                      <span class="font-medium">协议:</span>
                      <span>${config.protocol.toUpperCase()}</span>
                  </div>
                  <div class="flex gap-1.5">
                      <span class="font-medium">服务器:</span>
                      <span>${config.serverUrl}</span>
                  </div>
                  <div class="flex gap-1.5">
                      <span class="font-medium">最后使用:</span>
                      <span>${lastUsed}</span>
                  </div>
                  ${config.description ? `
                      <div class="flex gap-1.5 col-span-full">
                          <span class="font-medium">描述:</span>
                          <span>${config.description}</span>
                      </div>
                  ` : ''}
              </div>
          `;

          container.appendChild(configItem);
        });

        this.elements.configCount.textContent = this.configs.length;
      }

      exportConfigs() {
        const dataStr = JSON.stringify(this.configs, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `stream-configs-${new Date().toISOString().split('T')[0]}.json`;
        a.click();

        URL.revokeObjectURL(url);
        this.showToast('配置已导出', 'success');
      }

      importConfigs(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const importedConfigs = JSON.parse(e.target.result);

            if (Array.isArray(importedConfigs)) {
              // 为导入的配置生成新的ID
              importedConfigs.forEach(config => {
                config.id = Date.now() + Math.random();
              });

              this.configs.push(...importedConfigs);
              this.saveConfigs();
              this.renderConfigs();
              this.showToast(`成功导入 ${importedConfigs.length} 个配置`, 'success');
            } else {
              throw new Error('文件格式无效');
            }
          } catch (error) {
            this.showToast('导入失败: ' + error.message, 'error');
          }
        };

        reader.readAsText(file);
        event.target.value = ''; // 清除文件选择
      }

      loadDefaultConfigs() {
        if (this.configs.length === 0) {
          const defaultConfigs = [
            {
              id: 1,
              name: '本地开发环境',
              streamName: 'demo',
              protocol: 'flv',
              serverUrl: 'localhost:8000',
              autoReconnect: true,
              lowLatency: true,
              bufferSize: 128,
              maxRetries: 5,
              customHeaders: '',
              description: '本地开发测试用的默认配置',
              createdAt: new Date().toISOString(),
              lastUsed: null
            },
            {
              id: 2,
              name: '测试环境',
              streamName: 'test',
              protocol: 'flv',
              serverUrl: 'localhost:8000',
              autoReconnect: true,
              lowLatency: false,
              bufferSize: 256,
              maxRetries: 3,
              customHeaders: '',
              description: '测试环境专用配置',
              createdAt: new Date().toISOString(),
              lastUsed: null
            }
          ];

          this.configs = defaultConfigs;
          this.saveConfigs();
          this.renderConfigs();
        }
      }

      showToast(message, type = 'info') {
        const toast = document.createElement('div');
        const bgColors = {
          'info': 'bg-blue-500',
          'success': 'bg-green-500',
          'error': 'bg-red-500'
        };
        toast.className = `toast ${bgColors[type] || bgColors.info}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => document.body.removeChild(toast), 300);
        }, 3000);
      }
    }

    // 初始化配置管理器
    document.addEventListener('DOMContentLoaded', () => {
      window.configManager = new StreamConfigManager();
    });
  </script>
</body>

</html>